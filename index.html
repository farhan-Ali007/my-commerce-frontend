<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Optimized Google Tag Manager (load after interaction) -->
    <script>
      (function (w, d, s, l, i) {
        // Minimal dataLayer stub
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        
        function loadGTM() {
          if (w.__gtmLoaded) return;
          w.__gtmLoaded = true;
          var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
          j.async = true;
          j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
          f.parentNode.insertBefore(j, f);
        }
        
        // Load GTM after user interaction or on commerce pages
        var path = (w.location && w.location.pathname) || '/';
        var isCommercePage = /\b(product|cart|checkout)\b/.test(path);
        
        if (isCommercePage) {
          // Load immediately on commerce pages
          (w.requestIdleCallback || function(cb){ setTimeout(cb, 100); })(loadGTM);
        } else {
          // Load after first interaction on other pages
          var events = ['mousedown', 'keydown', 'scroll', 'touchstart'];
          var loaded = false;
          var loadOnce = function() {
            if (loaded) return;
            loaded = true;
            events.forEach(function(e) {
              d.removeEventListener(e, loadOnce, { passive: true });
            });
            (w.requestIdleCallback || function(cb){ setTimeout(cb, 100); })(loadGTM);
          };
          events.forEach(function(e) {
            d.addEventListener(e, loadOnce, { passive: true, once: true });
          });
          // Fallback: load after 3 seconds
          setTimeout(loadOnce, 3000);
        }
      })(window, document, "script", "dataLayer", "GTM-WB2JJH4Z");
    </script>
    <!-- End Optimized Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Performance: Preconnect to critical origins -->
    <link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
    <link rel="dns-prefetch" href="//res.cloudinary.com">
    <!-- If your API is cross-origin, preconnect can reduce handshake latency -->
    <link rel="preconnect" href="https://etimadmart.up.railway.app" crossorigin>
    <link rel="dns-prefetch" href="//etimadmart.up.railway.app">

    <!-- Optional: Preload a safe fallback hero banner to improve LCP discovery.
         If your first banner image is stable, replace the href/srcset with that URL.
         Otherwise this still gives the browser a head start for a likely hero asset. -->
    <link
      rel="preload"
      as="image"
      href="/customBanner1.webp"
      imagesrcset="/customBanner1.webp 480w, /customBanner1.webp 1024w, /customBanner1.webp 1920w"
      imagesizes="100vw"
    />
    <link rel="preconnect" href="https://res.cloudinary.com" crossorigin>
    <link rel="preconnect" href="https://etimadmart.com" crossorigin>
    <link rel="preconnect" href="https://etimadmart.up.railway.app" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preconnect to Facebook for better caching -->
    <link rel="preconnect" href="https://connect.facebook.net" crossorigin>
    <link rel="dns-prefetch" href="https://www.facebook.com">

    <!-- Performance: Preload LCP hero image (first banner) -->
    <link
      rel="preload"
      as="image"
      href="/customBanner1.webp"
      imagesrcset="/customBanner1.webp 800w, /customBanner1.webp 1200w, /customBanner1.webp 1920w"
      imagesizes="100vw"
    />
    <!-- Preload splash logo early so it appears instantly -->
    <link rel="preload" as="image" href="/f-logo.png" />
    <!-- Content Security Policy Meta Tag (Backup for cPanel) -->
    <meta
      http-equiv="Content-Security-Policy"
      content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://connect.facebook.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' data: https://fonts.gstatic.com;
    img-src 'self' data: https: blob: https://res.cloudinary.com https://www.facebook.com;
    connect-src 'self' https://etimadmart.com   https://etimadmart.up.railway.app https://etimadmart.com/api/v1 https://www.google-analytics.com https://res.cloudinary.com https://www.facebook.com;
    frame-src 'self';
    object-src 'none';
    base-uri 'self';
    form-action 'self'
  "
    />
    <meta
      name="google-site-verification"
      content="XFfrylpN_jyzGe1E23oSqq85BIkGc_GUToUX4Sv1jyg"
    />
    <link rel="icon" type="image/png" href="/top-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Load Poppins asynchronously to avoid render-blocking; rely on system-ui fallback initially -->
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
    </noscript>

    <!-- Secondary fonts loaded asynchronously to avoid render-blocking -->
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
    </noscript>
    
    <!-- CRITICAL CSS FOR PERFORMANCE -->
    <style>
      /* Critical CSS for Above-the-Fold Content - Inlined for best performance */
      .banner-container{position:relative;width:100%;height:0;padding-top:28.65%;background-color:#f3f4f6;overflow:hidden;contain:layout style paint}.banner-image{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center}.banner-skeleton{position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:loading 1.5s infinite}@keyframes loading{0%{background-position:200% 0}100%{background-position:-200% 0}}@media (max-width:640px){.banner-container{padding-top:29.17%}}@media (max-width:1024px) and (min-width:641px){.banner-container{padding-top:31.25%}}.navbar{position:sticky;top:0;z-index:1000;background-color:white;box-shadow:0 2px 4px rgba(0,0,0,0.1)}.main-container{min-height:100vh;display:flex;flex-direction:column}.content-wrapper{flex:1}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell',sans-serif;line-height:1.6;color:#333;margin:0;padding:0}.prevent-cls{contain:layout style paint}.focus-visible{outline:2px solid #4F46E5;outline-offset:2px}@media (prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:0.01ms!important;animation-iteration-count:1!important;transition-duration:0.01ms!important}}
    </style>
    
    <!-- ADDITIONAL PERFORMANCE OPTIMIZATIONS -->
    <link rel="dns-prefetch" href="//etimadmart.up.railway.app">
    <link rel="prefetch" href="/customBanner2.webp">
    <meta name="theme-color" content="#ffffff">
    <meta name="color-scheme" content="light">
    
    <title>Etimad Mart</title>
    <!-- Minimal Google Analytics (defer until interaction) -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      
      function loadGA() {
        if (window.__gaLoaded) return;
        window.__gaLoaded = true;
        var s = document.createElement('script');
        s.async = true;
        s.src = 'https://www.googletagmanager.com/gtag/js?id=G-E9DQ6Y0HFP';
        document.head.appendChild(s);
        s.onload = function() {
          gtag('js', new Date());
          gtag('config', 'G-E9DQ6Y0HFP', {
            send_page_view: false // Prevent automatic pageview
          });
          gtag('event', 'page_view'); // Manual pageview
        };
      }
      
      // Load GA after user interaction
      var events = ['mousedown', 'keydown', 'scroll', 'touchstart'];
      var loaded = false;
      var loadOnce = function() {
        if (loaded) return;
        loaded = true;
        events.forEach(function(e) {
          document.removeEventListener(e, loadOnce);
        });
        (window.requestIdleCallback || function(cb){ setTimeout(cb, 200); })(loadGA);
      };
      events.forEach(function(e) {
        document.addEventListener(e, loadOnce, { passive: true, once: true });
      });
      // Fallback: load after 4 seconds
      setTimeout(loadOnce, 4000);
    </script>
    <!-- Ultra-light Meta Pixel (load only on conversion pages) -->
    <script>
      (function (w, d) {
        // Only load Facebook Pixel on pages where conversions happen
        var path = (w.location && w.location.pathname) || '/';
        var isConversionPage = /\b(product|cart|checkout|thank)\b/.test(path);
        
        if (!isConversionPage) {
          // Just stub fbq for non-conversion pages to prevent errors
          w.fbq = w.fbq || function(){ (w.fbq.q = w.fbq.q || []).push(arguments); };
          return;
        }
        
        // Full pixel only on conversion pages
        if (!w.fbq) {
          var n = function(){ n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments); };
          n.queue = []; n.version = '2.0'; n.loaded = false; w.fbq = n; w._fbq = n;
        }

        function loadFbPixel() {
          if (w.__fbPixelLoaded) return; w.__fbPixelLoaded = true;
          var s = d.createElement('script');
          s.async = true;
          s.src = 'https://connect.facebook.net/en_US/fbevents.js';
          s.crossOrigin = 'anonymous';
          s.referrerPolicy = 'strict-origin-when-cross-origin';
          var first = d.getElementsByTagName('script')[0];
          first.parentNode.insertBefore(s, first);
          s.onload = function(){
            try { fbq('init', '2204362540002843'); fbq('track', 'PageView'); } catch(e) {}
          };
        }

        // Load after minimal delay on conversion pages
        (w.requestIdleCallback || function(cb){ setTimeout(cb, 500); })(loadFbPixel);
      })(window, document);
    </script>
    <!-- End Ultra-light Meta Pixel -->
    
    <!-- PERFORMANCE MONITORING & OPTIMIZATION SCRIPT -->
    <script>
      // Performance monitoring and optimization
      (function() {
        // Mark critical resources
        if ('performance' in window && 'mark' in performance) {
          performance.mark('head-start');
        }
        
        // Optimize font loading
        if ('fonts' in document) {
          document.fonts.ready.then(function() {
            if ('performance' in window && 'mark' in performance) {
              performance.mark('fonts-loaded');
            }
          });
        }
        
        // Preload next banner image after LCP
        window.addEventListener('load', function() {
          setTimeout(function() {
            // Prefetch additional resources after initial load
            var resources = ['/customBanner2.webp', '/api/products', '/api/categories'];
            resources.forEach(function(href) {
              var link = document.createElement('link');
              link.rel = 'prefetch';
              link.href = href;
              document.head.appendChild(link);
            });
          }, 1000);
        });
        
        // Performance monitoring
        window.addEventListener('load', function() {
          setTimeout(function() {
            if ('performance' in window) {
              var perfData = performance.getEntriesByType('navigation')[0];
              if (perfData) {
                console.log('Performance Metrics:', {
                  'DOM Content Loaded': Math.round(perfData.domContentLoadedEventEnd - perfData.domContentLoadedEventStart),
                  'Load Complete': Math.round(perfData.loadEventEnd - perfData.loadEventStart),
                  'Total Load Time': Math.round(perfData.loadEventEnd - perfData.fetchStart)
                });
              }
            }
          }, 100);
        });
      })();
    </script>
  </head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-WB2JJH4Z"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <noscript
      ><img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=2204362540002843&ev=PageView&noscript=1"
    /></noscript>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
